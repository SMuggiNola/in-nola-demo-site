<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="../assets/in_logo.png">
  <meta charset="UTF-8">
  <title>Task Dashboard | Irish Network NOLA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/global.css">
  <style>
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .dashboard-header h1 {
      margin: 0;
    }

    .logout-btn {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    .progress-summary {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .progress-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 1rem 1.5rem;
      text-align: center;
      min-width: 120px;
    }

    .progress-card .number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gold);
    }

    .progress-card .label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .phase-section {
      margin-bottom: 1rem;
    }

    .phase-header {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all var(--transition);
    }

    .phase-header:hover {
      background: var(--glass-hover);
      border-color: rgba(212, 167, 38, 0.3);
    }

    .phase-header.active {
      border-radius: var(--radius) var(--radius) 0 0;
      border-bottom-color: transparent;
    }

    .phase-title {
      font-family: 'Cinzel Decorative', serif;
      font-size: 1.1rem;
      color: var(--gold);
      margin: 0;
    }

    .phase-status {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .phase-count {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .phase-arrow {
      transition: transform 0.3s ease;
      color: var(--gold);
    }

    .phase-header.active .phase-arrow {
      transform: rotate(180deg);
    }

    .phase-content {
      background: rgba(13, 40, 24, 0.4);
      border: 1px solid var(--glass-border);
      border-top: none;
      border-radius: 0 0 var(--radius) var(--radius);
      padding: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
    }

    .phase-content.open {
      padding: 1rem 1.25rem;
      max-height: 2000px;
    }

    .phase-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-style: italic;
      margin: 0 0 1rem 0;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.6rem 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s ease;
      text-decoration: none;
    }

    .task-item:hover {
      background: rgba(212, 167, 38, 0.1);
    }

    .task-item:last-child {
      border-bottom: none;
    }

    .task-checkbox {
      color: var(--gold);
      font-size: 1.1rem;
      flex-shrink: 0;
      margin-top: 0.1rem;
    }

    .task-checkbox.done {
      color: #86efac;
    }

    .task-text {
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .task-text.done {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .task-text strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    .owner-tag {
      display: inline-block;
      font-size: 0.65rem;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      margin-left: 0.5rem;
      vertical-align: middle;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .owner-tag.board {
      background: rgba(212, 167, 38, 0.25);
      color: #f0c040;
      border: 1px solid rgba(212, 167, 38, 0.4);
    }

    .owner-tag.treasurer {
      background: rgba(168, 85, 247, 0.2);
      color: #c084fc;
      border: 1px solid rgba(168, 85, 247, 0.4);
    }

    .owner-tag.tech {
      background: rgba(100, 116, 139, 0.2);
      color: #94a3b8;
      border: 1px solid rgba(100, 116, 139, 0.3);
    }

    /* Dim tech tasks so board tasks stand out */
    .task-item.owner-tech {
      opacity: 0.6;
    }

    .task-item.owner-tech:hover {
      opacity: 1;
    }

    /* Highlight board/treasurer tasks */
    .task-item.owner-board,
    .task-item.owner-treasurer {
      background: rgba(212, 167, 38, 0.05);
    }

    .task-item.owner-treasurer {
      background: rgba(168, 85, 247, 0.05);
    }

    .legend-box {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .subsection-title {
      color: var(--gold);
      font-size: 0.9rem;
      font-weight: 600;
      margin: 1rem 0 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .subsection-title:first-child {
      margin-top: 0;
      padding-top: 0;
      border-top: none;
    }

    .back-link {
      text-align: center;
      margin-top: 2rem;
    }

    .back-link a {
      color: var(--text-secondary);
      text-decoration: none;
    }

    .back-link a:hover {
      color: var(--gold);
    }
  </style>
</head>

<body>

  <div id="main-header-placeholder"></div>

  <div id="main-content">
    <main class="page-content" style="max-width: 800px;">

      <div class="dashboard-header">
        <h1>Task Dashboard</h1>
        <button id="logoutBtn" class="btn btn-gold logout-btn">Sign Out</button>
      </div>

      <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: var(--radius); padding: 1.25rem; margin-bottom: 2rem;">
        <p style="text-align: center; margin-bottom: 1rem;">
          Project tasks and progress for the IN-NOLA website and membership portal.
        </p>
        <div style="background: rgba(212, 167, 38, 0.1); border-radius: 8px; padding: 1rem; font-size: 0.9rem;">
          <strong style="color: var(--gold);">How to Help:</strong>
          <ol style="margin: 0.5rem 0 0 1.25rem; padding: 0; color: var(--text-secondary);">
            <li>Look for <span class="owner-tag board">Board</span> or <span class="owner-tag treasurer">Treasurer</span> tags - those need your input</li>
            <li>Click any task to open an email with the task name pre-filled</li>
            <li>Add any info, credentials, or details needed</li>
            <li><span class="owner-tag tech">Tech</span> tasks are handled by Sean - no action needed from you</li>
          </ol>
          <div class="legend-box">
            <div class="legend-item"><span class="owner-tag board">Board</span> Needs board member input</div>
            <div class="legend-item"><span class="owner-tag treasurer">Treasurer</span> Needs treasurer action</div>
            <div class="legend-item"><span class="owner-tag tech">Tech</span> Technical work (Sean)</div>
          </div>
        </div>
      </div>

      <div class="progress-summary">
        <div class="progress-card">
          <div class="number" id="totalTasks">0</div>
          <div class="label">Total Tasks</div>
        </div>
        <div class="progress-card">
          <div class="number" id="completedTasks">0</div>
          <div class="label">Completed</div>
        </div>
        <div class="progress-card">
          <div class="number" id="remainingTasks">0</div>
          <div class="label">Remaining</div>
        </div>
        <div class="progress-card">
          <div class="number" id="boardTasks">0</div>
          <div class="label">Board Tasks</div>
        </div>
      </div>

      <div id="phasesContainer"></div>

      <div class="back-link">
        <a href="home.html">Back to Admin Portal</a>
      </div>

    </main>

    <div id="main-footer-placeholder"></div>
  </div>

  <script src="/js/main.js"></script>
  <script src="/js/admin-auth.js"></script>
  <script>
    // Logout handler
    document.getElementById('logoutBtn').addEventListener('click', function() {
      adminLogout();
    });

    // Task data with owner assignments
    // owner: "board" = needs board member input, "treasurer" = needs treasurer, "tech" = Sean handles it
    const phases = [
      // ── ACTIVE ──
      {
        title: "Membership Pipeline",
        description: "Goal: every member — current and future — gets access to a membership portal with their member-in-good-standing certificate and QR code. The backend infrastructure (KV database, login API, CSV import, QR system) is built. Now it's about getting real members through the pipeline.",
        tasks: [
          { done: false, text: "<strong>Phase 1: Current Members</strong> - Import existing roster from Google Sheet", owner: "tech", subtasks: [
            { done: true, text: "Member database built (Cloudflare KV)", owner: "tech" },
            { done: true, text: "CSV import tool built", owner: "tech" },
            { done: true, text: "Member login system built (username + PIN)", owner: "tech" },
            { done: true, text: "Membership certificate page built", owner: "tech" },
            { done: true, text: "QR code generation and scanning built", owner: "tech" },
            { done: false, text: "Create MEMBERS_KV namespace in production", owner: "tech" },
            { done: false, text: "Add MEMBER_SECRET environment variable", owner: "tech" },
            { done: false, text: "Send current membership roster for import", owner: "board" },
            { done: false, text: "Import roster and distribute login credentials", owner: "tech" }
          ]},
          { done: false, text: "<strong>Phase 2: Google Form Enrollment</strong> - New members sign up via Google Form, get imported into system", owner: "tech", subtasks: [
            { done: false, text: "Define workflow: Form \u2192 Sheet \u2192 CSV export \u2192 Import", owner: "tech" },
            { done: false, text: "Send welcome email with login credentials", owner: "tech" },
            { done: false, text: "Document import process for board members", owner: "tech" }
          ]},
          { done: false, text: "<strong>Phase 3: Website Enrollment</strong> - Members sign up and pay directly on in-nola.org", owner: "tech", subtasks: [
            { done: false, text: "Membership signup page with tier selection", owner: "tech" },
            { done: false, text: "PayPal payment integration", owner: "tech" },
            { done: false, text: "Automatic member creation after payment", owner: "tech" },
            { done: false, text: "Welcome email with login credentials", owner: "tech" },
            { done: false, text: "Member self-service (renewal, profile updates)", owner: "tech" }
          ]}
        ]
      },
      {
        title: "Administration Tools & Capabilities",
        description: "Tools for board members to manage the site, events, and membership from a unified admin portal.",
        tasks: [
          { done: true, text: "<strong>Unified admin login</strong> - Single sign-in across all admin pages", owner: "tech" },
          { done: true, text: "<strong>Board dashboard</strong> - Task tracking with color-coded ownership", owner: "tech" },
          { done: true, text: "<strong>Event management</strong> - Add, edit, and delete events from admin", owner: "tech" },
          { done: true, text: "<strong>Member CSV import</strong> - Bulk import from spreadsheet", owner: "tech" },
          { done: true, text: "<strong>QR code generator</strong> - Printable member QR codes", owner: "tech" },
          { done: true, text: "<strong>QR verification scanner</strong> - Scan and verify member status", owner: "tech" },
          { done: true, text: "<strong>Site QR code</strong> - Permanent high-res QR linking to in-nola.org, accessible from homepage", owner: "tech" },
          { done: true, text: "<strong>Landing page quick-access buttons</strong> - Member Login, Admin Scanner, Board Portal, QR Download", owner: "tech" },
          { done: true, text: "<strong>Dynamic next event banner</strong> - Auto-loads upcoming event from API on homepage", owner: "tech" },
          { done: true, text: "<strong>Member login portal</strong> - Username + PIN login page for members", owner: "tech" },
          { done: true, text: "<strong>Ticketing system</strong> - Board members submit requests, track completed work", owner: "tech", subtasks: [
            { done: true, text: "Submit new request form (title, description, priority)", owner: "tech" },
            { done: true, text: "View open and completed tickets", owner: "tech" },
            { done: true, text: "Status updates and comments on tickets", owner: "tech" },
            { done: true, text: "KV storage for ticket data", owner: "tech" }
          ]},
          { done: false, text: "<strong>Member management</strong> - Edit and remove individual members", owner: "tech" },
          { done: false, text: "<strong>Export member list</strong> - CSV download of roster", owner: "tech" },
          { done: false, text: "<strong>Renewal reminders</strong> - Automated email notifications", owner: "tech" },
          { done: false, text: "<strong>Spam protection</strong> - Add CAPTCHA/Turnstile to contact form", owner: "tech" },
          { done: false, text: "<strong>Contact form confirmation</strong> - Email confirmation to submitter", owner: "tech" },
          { done: false, text: "<strong>Rate limiting</strong> - Prevent form abuse", owner: "tech" }
        ]
      },
      {
        title: "QuickBooks Integration",
        description: "Sync new members to QuickBooks automatically. Treasurer needs to set up QB side first.",
        tasks: [
          { done: true, text: "<strong>Integration approach decided</strong> - Website syncs to QuickBooks automatically", owner: "tech" },
          { done: false, text: "<strong>QuickBooks setup</strong>", owner: "treasurer", subtasks: [
            { done: false, text: "Ensure QuickBooks Online subscription (Plus or Advanced)", owner: "treasurer" },
            { done: false, text: "Set up Customer list structure for members", owner: "treasurer" },
            { done: false, text: "Create Products/Services for membership tiers", owner: "treasurer" },
            { done: false, text: "Set up recurring invoices template", owner: "treasurer" },
            { done: false, text: "Decide: QuickBooks Payments vs PayPal vs both", owner: "board" }
          ]},
          { done: false, text: "<strong>QuickBooks API setup</strong> - Developer portal credentials", owner: "tech" },
          { done: false, text: "<strong>Build sync endpoints</strong> - Connect website to QuickBooks", owner: "tech" },
          { done: false, text: "<strong>Map data fields</strong>", owner: "tech", subtasks: [
            { done: false, text: "Member Name to Customer DisplayName", owner: "tech" },
            { done: false, text: "Email to PrimaryEmailAddr", owner: "tech" },
            { done: false, text: "Membership Type to custom field", owner: "tech" },
            { done: false, text: "Expiration Date to custom field", owner: "tech" }
          ]}
        ]
      },
      {
        title: "Website Logistics",
        description: "Site structure, navigation flow, content cleanup, and general polish. Parking lot for things that need attention when there's bandwidth.",
        tasks: [
          { done: false, text: "<strong>Review site navigation flow</strong> - Make sure paths between pages make sense", owner: "tech" },
          { done: false, text: "<strong>Consistent page structure</strong> - Headers, footers, back links across all pages", owner: "tech" },
          { done: false, text: "<strong>CSS cleanup</strong> - Reduce duplication across stylesheets", owner: "tech" },
          { done: false, text: "<strong>Mobile responsiveness audit</strong> - Test all pages on phone/tablet", owner: "tech" },
          { done: false, text: "<strong>Content Security Policy</strong> - Add security headers", owner: "tech" },
          { done: false, text: "<strong>Add .gitignore and package.json</strong> - Standard project housekeeping", owner: "tech" }
        ]
      },
      // ── COMPLETE ──
      {
        title: "Complete: Migration to New Website",
        description: "Domain transfer from WordPress, Cloudflare infrastructure setup, email configuration, and cleanup.",
        tasks: [
          { done: true, text: "<strong>Create IN-NOLA Cloudflare account</strong> - Organization account", owner: "board" },
          { done: true, text: "<strong>Complete in-nola.org domain transfer</strong>", owner: "board", subtasks: [
            { done: true, text: "Unlock domain at WordPress", owner: "board" },
            { done: true, text: "Get Authorization Code from WordPress", owner: "board" },
            { done: true, text: "Verify domain eligibility (60+ days old)", owner: "board" },
            { done: true, text: "Copy existing DNS records", owner: "tech" },
            { done: true, text: "Initiate transfer in Cloudflare", owner: "tech" },
            { done: true, text: "Pay for 1 year renewal", owner: "board" },
            { done: true, text: "Approve transfer via email", owner: "board" },
            { done: true, text: "Wait for transfer to complete", owner: "tech" }
          ]},
          { done: true, text: "<strong>Add custom domain</strong> - Connect in-nola.org to website", owner: "tech" },
          { done: true, text: "<strong>Set up email routing</strong> - Create contact@in-nola.org", owner: "tech" },
          { done: true, text: "<strong>Configure email sending</strong> - Send from in-nola.org via Resend", owner: "tech" },
          { done: true, text: "<strong>Test contact form</strong> - Verified working", owner: "tech" },
          { done: true, text: "<strong>Secure API credentials</strong> - Moved to environment variables", owner: "tech" },
          { done: true, text: "<strong>Remove debug output</strong> - Cleaned up contact form error responses", owner: "tech" },
          { done: true, text: "<strong>Update documentation</strong> - Reflect current Resend email setup", owner: "tech" },
          { done: false, text: "<strong>Remove old MailChannels DNS records</strong> - Clean up unused email config in Cloudflare", owner: "tech" }
        ]
      },
      {
        title: "Complete: PayPal Setup",
        description: "PayPal configured to accept membership dues and donations.",
        tasks: [
          { done: true, text: "<strong>PayPal Business account</strong> - Upgraded to business", owner: "board" },
          { done: true, text: "<strong>Developer credentials</strong> - App created for payment processing", owner: "tech" },
          { done: true, text: "<strong>Set membership pricing tiers</strong>", owner: "board", subtasks: [
            { done: true, text: "Individual membership", owner: "board" },
            { done: true, text: "Family membership", owner: "board" },
            { done: true, text: "Lifetime membership", owner: "board" }
          ]},
          { done: true, text: "<strong>Configure payment notifications</strong> - Webhook setup", owner: "tech" }
        ]
      }
    ];

    // Email config
    const BOARD_EMAIL = 'sean.muggivan@gmail.com';

    // Helper to strip HTML and create mailto link
    function createMailtoLink(taskText, phaseTitle) {
      const plainText = taskText.replace(/<[^>]*>/g, '').trim();
      const subject = encodeURIComponent(`[IN-NOLA Task] ${phaseTitle}: ${plainText}`);
      const body = encodeURIComponent(`Hi Sean,\n\nRegarding the task: "${plainText}"\n\nHere's the information you need:\n\n\n\n---\nSent from IN-NOLA Board Portal`);
      return `mailto:${BOARD_EMAIL}?subject=${subject}&body=${body}`;
    }

    // Helper to get owner tag HTML
    function getOwnerTag(owner) {
      const labels = {
        board: 'Board',
        treasurer: 'Treasurer',
        tech: 'Tech'
      };
      return owner ? `<span class="owner-tag ${owner}">${labels[owner] || owner}</span>` : '';
    }

    // Render phases
    function renderPhases() {
      const container = document.getElementById('phasesContainer');
      let totalTasks = 0;
      let completedTasks = 0;
      let boardTasks = 0;

      phases.forEach((phase, index) => {
        const phaseEl = document.createElement('div');
        phaseEl.className = 'phase-section';

        let phaseDone = 0;
        let phaseTotal = 0;

        // Count tasks
        phase.tasks.forEach(task => {
          phaseTotal++;
          if (task.done) phaseDone++;
          if (!task.done && (task.owner === 'board' || task.owner === 'treasurer')) boardTasks++;
          if (task.subtasks) {
            task.subtasks.forEach(sub => {
              phaseTotal++;
              if (sub.done) phaseDone++;
              if (!sub.done && (sub.owner === 'board' || sub.owner === 'treasurer')) boardTasks++;
            });
          }
        });

        totalTasks += phaseTotal;
        completedTasks += phaseDone;

        // Build task HTML
        let tasksHtml = '';
        phase.tasks.forEach(task => {
          const checkIcon = task.done ? '&#10003;' : '&#9675;';
          const checkClass = task.done ? 'done' : '';
          const ownerTag = getOwnerTag(task.owner);
          const ownerClass = task.owner ? `owner-${task.owner}` : '';
          const mailtoLink = createMailtoLink(task.text, phase.title);

          tasksHtml += `
            <a href="${mailtoLink}" class="task-item ${ownerClass}" title="Click to email info about this task">
              <span class="task-checkbox ${checkClass}">${checkIcon}</span>
              <span class="task-text ${checkClass}">${task.text}${ownerTag}</span>
            </a>
          `;

          if (task.subtasks) {
            task.subtasks.forEach(sub => {
              const subCheckIcon = sub.done ? '&#10003;' : '&#9675;';
              const subCheckClass = sub.done ? 'done' : '';
              const subOwnerTag = getOwnerTag(sub.owner);
              const subOwnerClass = sub.owner ? `owner-${sub.owner}` : '';
              const subMailtoLink = createMailtoLink(sub.text, phase.title);
              tasksHtml += `
                <a href="${subMailtoLink}" class="task-item ${subOwnerClass}" style="padding-left: 1.5rem;" title="Click to email info about this task">
                  <span class="task-checkbox ${subCheckClass}">${subCheckIcon}</span>
                  <span class="task-text ${subCheckClass}">${sub.text}${subOwnerTag}</span>
                </a>
              `;
            });
          }
        });

        const descriptionHtml = phase.description
          ? `<p class="phase-description">${phase.description}</p>`
          : '';

        phaseEl.innerHTML = `
          <div class="phase-header" data-index="${index}">
            <h3 class="phase-title">${phase.title}</h3>
            <div class="phase-status">
              <span class="phase-count">${phaseDone}/${phaseTotal}</span>
              <span class="phase-arrow">&#9660;</span>
            </div>
          </div>
          <div class="phase-content" data-index="${index}">
            ${descriptionHtml}
            ${tasksHtml}
          </div>
        `;

        container.appendChild(phaseEl);
      });

      // Update summary
      document.getElementById('totalTasks').textContent = totalTasks;
      document.getElementById('completedTasks').textContent = completedTasks;
      document.getElementById('remainingTasks').textContent = totalTasks - completedTasks;
      document.getElementById('boardTasks').textContent = boardTasks;
    }

    // Toggle phase dropdowns
    document.addEventListener('click', function(e) {
      const header = e.target.closest('.phase-header');
      if (header) {
        const index = header.dataset.index;
        const content = document.querySelector(`.phase-content[data-index="${index}"]`);

        header.classList.toggle('active');
        content.classList.toggle('open');
      }
    });

    // Initialize
    renderPhases();
  </script>

</body>
</html>
