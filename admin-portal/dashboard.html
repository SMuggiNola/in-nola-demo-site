<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="../assets/in_logo.png">
  <meta charset="UTF-8">
  <title>Board Dashboard | Irish Network NOLA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/global.css">
  <style>
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .dashboard-header h1 {
      margin: 0;
    }

    .logout-btn {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    .progress-summary {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .progress-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 1rem 1.5rem;
      text-align: center;
      min-width: 120px;
    }

    .progress-card .number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gold);
    }

    .progress-card .label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .phase-section {
      margin-bottom: 1rem;
    }

    .phase-header {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all var(--transition);
    }

    .phase-header:hover {
      background: var(--glass-hover);
      border-color: rgba(212, 167, 38, 0.3);
    }

    .phase-header.active {
      border-radius: var(--radius) var(--radius) 0 0;
      border-bottom-color: transparent;
    }

    .phase-title {
      font-family: 'Cinzel Decorative', serif;
      font-size: 1.1rem;
      color: var(--gold);
      margin: 0;
    }

    .phase-status {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .phase-count {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .phase-arrow {
      transition: transform 0.3s ease;
      color: var(--gold);
    }

    .phase-header.active .phase-arrow {
      transform: rotate(180deg);
    }

    .phase-content {
      background: rgba(13, 40, 24, 0.4);
      border: 1px solid var(--glass-border);
      border-top: none;
      border-radius: 0 0 var(--radius) var(--radius);
      padding: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
    }

    .phase-content.open {
      padding: 1rem 1.25rem;
      max-height: 2000px;
    }

    .phase-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-style: italic;
      margin: 0 0 1rem 0;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.6rem 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s ease;
      text-decoration: none;
    }

    .task-item:hover {
      background: rgba(212, 167, 38, 0.1);
    }

    .task-item:last-child {
      border-bottom: none;
    }

    .task-checkbox {
      color: var(--gold);
      font-size: 1.1rem;
      flex-shrink: 0;
      margin-top: 0.1rem;
    }

    .task-checkbox.done {
      color: #86efac;
    }

    .task-text {
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .task-text.done {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .task-text strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    .owner-tag {
      display: inline-block;
      font-size: 0.65rem;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      margin-left: 0.5rem;
      vertical-align: middle;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .owner-tag.board {
      background: rgba(212, 167, 38, 0.25);
      color: #f0c040;
      border: 1px solid rgba(212, 167, 38, 0.4);
    }

    .owner-tag.treasurer {
      background: rgba(168, 85, 247, 0.2);
      color: #c084fc;
      border: 1px solid rgba(168, 85, 247, 0.4);
    }

    .owner-tag.tech {
      background: rgba(100, 116, 139, 0.2);
      color: #94a3b8;
      border: 1px solid rgba(100, 116, 139, 0.3);
    }

    /* Dim tech tasks so board tasks stand out */
    .task-item.owner-tech {
      opacity: 0.6;
    }

    .task-item.owner-tech:hover {
      opacity: 1;
    }

    /* Highlight board/treasurer tasks */
    .task-item.owner-board,
    .task-item.owner-treasurer {
      background: rgba(212, 167, 38, 0.05);
    }

    .task-item.owner-treasurer {
      background: rgba(168, 85, 247, 0.05);
    }

    .legend-box {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .subsection-title {
      color: var(--gold);
      font-size: 0.9rem;
      font-weight: 600;
      margin: 1rem 0 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .subsection-title:first-child {
      margin-top: 0;
      padding-top: 0;
      border-top: none;
    }

    .back-link {
      text-align: center;
      margin-top: 2rem;
    }

    .back-link a {
      color: var(--text-secondary);
      text-decoration: none;
    }

    .back-link a:hover {
      color: var(--gold);
    }
  </style>
</head>

<body>

  <div id="main-header-placeholder"></div>

  <div id="main-content">
    <main class="page-content" style="max-width: 800px;">

      <div class="dashboard-header">
        <h1>Board Dashboard</h1>
        <button id="logoutBtn" class="btn btn-gold logout-btn">Sign Out</button>
      </div>

      <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: var(--radius); padding: 1.25rem; margin-bottom: 2rem;">
        <p style="text-align: center; margin-bottom: 1rem;">
          Project tasks and progress for the IN-NOLA website and membership portal.
        </p>
        <div style="background: rgba(212, 167, 38, 0.1); border-radius: 8px; padding: 1rem; font-size: 0.9rem;">
          <strong style="color: var(--gold);">How to Help:</strong>
          <ol style="margin: 0.5rem 0 0 1.25rem; padding: 0; color: var(--text-secondary);">
            <li>Look for <span class="owner-tag board">Board</span> or <span class="owner-tag treasurer">Treasurer</span> tags - those need your input</li>
            <li>Click any task to open an email with the task name pre-filled</li>
            <li>Add any info, credentials, or details needed</li>
            <li><span class="owner-tag tech">Tech</span> tasks are handled by Sean - no action needed from you</li>
          </ol>
          <div class="legend-box">
            <div class="legend-item"><span class="owner-tag board">Board</span> Needs board member input</div>
            <div class="legend-item"><span class="owner-tag treasurer">Treasurer</span> Needs treasurer action</div>
            <div class="legend-item"><span class="owner-tag tech">Tech</span> Technical work (Sean)</div>
          </div>
        </div>
      </div>

      <div class="progress-summary">
        <div class="progress-card">
          <div class="number" id="totalTasks">0</div>
          <div class="label">Total Tasks</div>
        </div>
        <div class="progress-card">
          <div class="number" id="completedTasks">0</div>
          <div class="label">Completed</div>
        </div>
        <div class="progress-card">
          <div class="number" id="remainingTasks">0</div>
          <div class="label">Remaining</div>
        </div>
        <div class="progress-card">
          <div class="number" id="boardTasks">0</div>
          <div class="label">Board Tasks</div>
        </div>
      </div>

      <div id="phasesContainer"></div>

      <div class="back-link">
        <a href="/index.html">Return to Home</a>
      </div>

    </main>

    <div id="main-footer-placeholder"></div>
  </div>

  <script src="/js/main.js"></script>
  <script>
    // Check authentication
    if (sessionStorage.getItem('boardAuth') !== 'true') {
      window.location.href = 'index.html';
    }

    // Logout handler
    document.getElementById('logoutBtn').addEventListener('click', function() {
      sessionStorage.removeItem('boardAuth');
      window.location.href = 'index.html';
    });

    // Task data with owner assignments
    // owner: "board" = needs board member input, "treasurer" = needs treasurer, "tech" = Sean handles it
    const phases = [
      {
        title: "High Priority",
        description: "Critical items blocking other work. Domain transfer is the main blocker right now.",
        tasks: [
          { done: true, text: "<strong>Test contact form</strong> - Verified working", owner: "tech" },
          { done: true, text: "<strong>Secure API credentials</strong> - Moved to environment variables", owner: "tech" },
          { done: false, text: "<strong>Create IN-NOLA Cloudflare account</strong> - Organization account so infrastructure stays with IN-NOLA", owner: "board" },
          { done: false, text: "<strong>Complete in-nola.org domain transfer</strong>", owner: "board", subtasks: [
            { done: false, text: "Unlock domain at WordPress", owner: "board" },
            { done: false, text: "Get Authorization Code from WordPress", owner: "board" },
            { done: false, text: "Verify domain eligibility (60+ days old)", owner: "board" },
            { done: false, text: "Copy existing DNS records", owner: "tech" },
            { done: false, text: "Initiate transfer in Cloudflare", owner: "tech" },
            { done: false, text: "Pay for 1 year renewal", owner: "board" },
            { done: false, text: "Approve transfer via email", owner: "board" },
            { done: false, text: "Wait for transfer to complete (1-7 days)", owner: "tech" }
          ]}
        ]
      },
      {
        title: "Post-Domain Transfer",
        description: "These tasks unlock once we own in-nola.org. Sets up professional email and domain.",
        tasks: [
          { done: false, text: "<strong>Add custom domain</strong> - Connect in-nola.org to website", owner: "tech" },
          { done: false, text: "<strong>Set up email routing</strong> - Create contact@in-nola.org", owner: "tech" },
          { done: false, text: "<strong>Configure email sending</strong> - Send from in-nola.org domain", owner: "tech" }
        ]
      },
      {
        title: "Cleanup Tasks",
        description: "Housekeeping items to tidy up temporary configurations and documentation.",
        tasks: [
          { done: false, text: "<strong>Remove debug output</strong> - Clean up contact form logging", owner: "tech" },
          { done: false, text: "<strong>Remove old DNS records</strong> - Clean up unused email configuration", owner: "tech" },
          { done: false, text: "<strong>Update documentation</strong> - Reflect current email setup", owner: "tech" }
        ]
      },
      {
        title: "Phase 1: PayPal Setup",
        description: "Configure PayPal to accept membership dues. Need business account access and pricing decisions.",
        tasks: [
          { done: false, text: "<strong>PayPal Business account</strong> - Log in or upgrade to business", owner: "board" },
          { done: false, text: "<strong>Developer credentials</strong> - Create app for payment processing", owner: "tech" },
          { done: false, text: "<strong>Set membership pricing tiers</strong>", owner: "board", subtasks: [
            { done: false, text: "Individual membership ($XX/year)", owner: "board" },
            { done: false, text: "Family membership ($XX/year)", owner: "board" },
            { done: false, text: "Lifetime membership ($XXX one-time)", owner: "board" }
          ]},
          { done: false, text: "<strong>Configure payment notifications</strong> - Webhook setup", owner: "tech" }
        ]
      },
      {
        title: "Phase 2: Database Setup",
        description: "Create secure storage for member records. Technical work - no board input needed.",
        tasks: [
          { done: false, text: "<strong>Choose storage solution</strong> - Database for member records", owner: "tech" },
          { done: false, text: "<strong>Design member data structure</strong>", owner: "tech", subtasks: [
            { done: false, text: "Member ID, Name, Email", owner: "tech" },
            { done: false, text: "Username and PIN", owner: "tech" },
            { done: false, text: "Membership type and dates", owner: "tech" },
            { done: false, text: "Payment transaction reference", owner: "tech" },
            { done: false, text: "Status (active, expired, pending)", owner: "tech" }
          ]},
          { done: false, text: "<strong>Create database</strong> - Set up tables", owner: "tech" },
          { done: false, text: "<strong>Connect to website</strong> - Database integration", owner: "tech" }
        ]
      },
      {
        title: "Phase 3: Enrollment Flow",
        description: "Build the new member signup experience - from selecting a tier to receiving login credentials.",
        tasks: [
          { done: false, text: "<strong>Create signup page</strong>", owner: "tech", subtasks: [
            { done: false, text: "Membership tier selection", owner: "tech" },
            { done: false, text: "Personal info form (name, email, phone)", owner: "tech" },
            { done: false, text: "Terms & conditions checkbox", owner: "tech" }
          ]},
          { done: false, text: "<strong>Build enrollment backend</strong>", owner: "tech", subtasks: [
            { done: false, text: "Payment initiation", owner: "tech" },
            { done: false, text: "Payment confirmation handling", owner: "tech" },
            { done: false, text: "Return page after payment" , owner: "tech" }
          ]},
          { done: false, text: "<strong>Add PayPal checkout button</strong>", owner: "tech" },
          { done: false, text: "<strong>Generate member credentials</strong> - Username and PIN", owner: "tech" },
          { done: false, text: "<strong>Store new members</strong> - Save to database after payment", owner: "tech" },
          { done: false, text: "<strong>Send welcome email</strong> - Include login credentials", owner: "tech" }
        ]
      },
      {
        title: "Phase 4: Member Portal Updates",
        description: "Connect the existing member login and certificate pages to real member data.",
        tasks: [
          { done: false, text: "<strong>Update login system</strong> - Connect to real database", owner: "tech" },
          { done: false, text: "<strong>Replace demo data</strong> - Use actual member records", owner: "tech" },
          { done: false, text: "<strong>Build authentication endpoint</strong> - Login verification", owner: "tech" },
          { done: false, text: "<strong>Update certificate page</strong> - Pull real member data", owner: "tech" },
          { done: false, text: "<strong>Update QR scanner</strong> - Verify against database", owner: "tech" }
        ]
      },
      {
        title: "Phase 5: Admin Features",
        description: "Tools for board members to manage membership - view roster, export lists, send reminders.",
        tasks: [
          { done: false, text: "<strong>Admin dashboard</strong> - View all members", owner: "tech" },
          { done: false, text: "<strong>Member management</strong> - Add, edit, remove members", owner: "tech" },
          { done: false, text: "<strong>Export member list</strong> - CSV download", owner: "tech" },
          { done: false, text: "<strong>Renewal reminders</strong> - Automated emails", owner: "tech" },
          { done: false, text: "<strong>Payment history</strong> - View transaction records", owner: "tech" },
          { done: false, text: "<strong>Send current membership roster</strong> - Need existing member list to import", owner: "board" }
        ]
      },
      {
        title: "Phase 6: QuickBooks Integration",
        description: "Sync new members to QuickBooks automatically. Treasurer needs to set up QB side first.",
        tasks: [
          { done: true, text: "<strong>Integration approach decided</strong> - Website syncs to QuickBooks automatically", owner: "tech" },
          { done: false, text: "<strong>QuickBooks setup</strong>", owner: "treasurer", subtasks: [
            { done: false, text: "Ensure QuickBooks Online subscription (Plus or Advanced)", owner: "treasurer" },
            { done: false, text: "Set up Customer list structure for members", owner: "treasurer" },
            { done: false, text: "Create Products/Services for membership tiers", owner: "treasurer" },
            { done: false, text: "Set up recurring invoices template", owner: "treasurer" },
            { done: false, text: "Decide: QuickBooks Payments vs PayPal vs both", owner: "board" }
          ]},
          { done: false, text: "<strong>QuickBooks API setup</strong> - Developer portal credentials", owner: "tech" },
          { done: false, text: "<strong>Build sync endpoints</strong> - Connect website to QuickBooks", owner: "tech" },
          { done: false, text: "<strong>Map data fields</strong>", owner: "tech", subtasks: [
            { done: false, text: "Member Name to Customer DisplayName", owner: "tech" },
            { done: false, text: "Email to PrimaryEmailAddr", owner: "tech" },
            { done: false, text: "Membership Type to custom field", owner: "tech" },
            { done: false, text: "Expiration Date to custom field", owner: "tech" }
          ]}
        ]
      },
      {
        title: "Future Improvements",
        description: "Nice-to-have enhancements after core functionality is complete. Low priority for now.",
        tasks: [
          { done: false, text: "<strong>Spam protection</strong> - Add CAPTCHA to contact form", owner: "tech" },
          { done: false, text: "<strong>Email confirmation</strong> - Confirm contact form submissions", owner: "tech" },
          { done: false, text: "<strong>Rate limiting</strong> - Prevent form abuse", owner: "tech" }
        ]
      }
    ];

    // Email config
    const BOARD_EMAIL = 'sean.muggivan@gmail.com';

    // Helper to strip HTML and create mailto link
    function createMailtoLink(taskText, phaseTitle) {
      const plainText = taskText.replace(/<[^>]*>/g, '').trim();
      const subject = encodeURIComponent(`[IN-NOLA Task] ${phaseTitle}: ${plainText}`);
      const body = encodeURIComponent(`Hi Sean,\n\nRegarding the task: "${plainText}"\n\nHere's the information you need:\n\n\n\n---\nSent from IN-NOLA Board Portal`);
      return `mailto:${BOARD_EMAIL}?subject=${subject}&body=${body}`;
    }

    // Helper to get owner tag HTML
    function getOwnerTag(owner) {
      const labels = {
        board: 'Board',
        treasurer: 'Treasurer',
        tech: 'Tech'
      };
      return owner ? `<span class="owner-tag ${owner}">${labels[owner] || owner}</span>` : '';
    }

    // Render phases
    function renderPhases() {
      const container = document.getElementById('phasesContainer');
      let totalTasks = 0;
      let completedTasks = 0;
      let boardTasks = 0;

      phases.forEach((phase, index) => {
        const phaseEl = document.createElement('div');
        phaseEl.className = 'phase-section';

        let phaseDone = 0;
        let phaseTotal = 0;

        // Count tasks
        phase.tasks.forEach(task => {
          phaseTotal++;
          if (task.done) phaseDone++;
          if (!task.done && (task.owner === 'board' || task.owner === 'treasurer')) boardTasks++;
          if (task.subtasks) {
            task.subtasks.forEach(sub => {
              phaseTotal++;
              if (sub.done) phaseDone++;
              if (!sub.done && (sub.owner === 'board' || sub.owner === 'treasurer')) boardTasks++;
            });
          }
        });

        totalTasks += phaseTotal;
        completedTasks += phaseDone;

        // Build task HTML
        let tasksHtml = '';
        phase.tasks.forEach(task => {
          const checkIcon = task.done ? '&#10003;' : '&#9675;';
          const checkClass = task.done ? 'done' : '';
          const ownerTag = getOwnerTag(task.owner);
          const ownerClass = task.owner ? `owner-${task.owner}` : '';
          const mailtoLink = createMailtoLink(task.text, phase.title);

          tasksHtml += `
            <a href="${mailtoLink}" class="task-item ${ownerClass}" title="Click to email info about this task">
              <span class="task-checkbox ${checkClass}">${checkIcon}</span>
              <span class="task-text ${checkClass}">${task.text}${ownerTag}</span>
            </a>
          `;

          if (task.subtasks) {
            task.subtasks.forEach(sub => {
              const subCheckIcon = sub.done ? '&#10003;' : '&#9675;';
              const subCheckClass = sub.done ? 'done' : '';
              const subOwnerTag = getOwnerTag(sub.owner);
              const subOwnerClass = sub.owner ? `owner-${sub.owner}` : '';
              const subMailtoLink = createMailtoLink(sub.text, phase.title);
              tasksHtml += `
                <a href="${subMailtoLink}" class="task-item ${subOwnerClass}" style="padding-left: 1.5rem;" title="Click to email info about this task">
                  <span class="task-checkbox ${subCheckClass}">${subCheckIcon}</span>
                  <span class="task-text ${subCheckClass}">${sub.text}${subOwnerTag}</span>
                </a>
              `;
            });
          }
        });

        const descriptionHtml = phase.description
          ? `<p class="phase-description">${phase.description}</p>`
          : '';

        phaseEl.innerHTML = `
          <div class="phase-header" data-index="${index}">
            <h3 class="phase-title">${phase.title}</h3>
            <div class="phase-status">
              <span class="phase-count">${phaseDone}/${phaseTotal}</span>
              <span class="phase-arrow">&#9660;</span>
            </div>
          </div>
          <div class="phase-content" data-index="${index}">
            ${descriptionHtml}
            ${tasksHtml}
          </div>
        `;

        container.appendChild(phaseEl);
      });

      // Update summary
      document.getElementById('totalTasks').textContent = totalTasks;
      document.getElementById('completedTasks').textContent = completedTasks;
      document.getElementById('remainingTasks').textContent = totalTasks - completedTasks;
      document.getElementById('boardTasks').textContent = boardTasks;
    }

    // Toggle phase dropdowns
    document.addEventListener('click', function(e) {
      const header = e.target.closest('.phase-header');
      if (header) {
        const index = header.dataset.index;
        const content = document.querySelector(`.phase-content[data-index="${index}"]`);

        header.classList.toggle('active');
        content.classList.toggle('open');
      }
    });

    // Initialize
    renderPhases();
  </script>

</body>
</html>
